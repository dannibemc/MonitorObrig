<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecuriCredit Monitor - Sistema Completo</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.15/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #343E83 0%, #9E36EF 100%);
        }
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        .risk-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .risk-low { background-color: #10b981; }
        .risk-medium { background-color: #f59e0b; }
        .risk-high { background-color: #ef4444; }
        .modal-overlay {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Dados expandidos com novos campos
        const creditData = [
            { 
                id: "#CR-7845", 
                client: "Empresa ABC Ltda.", 
                cnpj: "12.345.678/0001-90", 
                type: "Imobiliário", 
                value: 1250000, 
                rate: 12.5, 
                status: "Adimplente", 
                progress: 75, 
                startDate: "15/03/2022", 
                endDate: "15/03/2027", 
                paidValue: 937500, 
                remainingValue: 312500, 
                nextPaymentDate: "15/07/2023", 
                installmentValue: 26042, 
                riskScore: 80, 
                documents: [], 
                alerts: [], 
                serasaRating: "AA",
                collateral: [
                    { type: "Imóvel", value: 1800000, description: "Apartamento Comercial - São Paulo" },
                    { type: "Garantia Pessoal", value: 500000, description: "Aval dos sócios" }
                ],
                covenants: [
                    { type: "Endividamento Líquido/EBITDA", limit: 3.5, current: 2.8, status: "OK" },
                    { type: "Cobertura de Juros", limit: 1.5, current: 2.2, status: "OK" }
                ],
                carenceDays: 15,
                curePeriod: 30,
                sector: "Construção Civil",
                pdd: 1.2,
                recoveryRate: 85
            },
            { 
                id: "#CR-7844", 
                client: "Construtora XYZ S.A.", 
                cnpj: "98.765.432/0001-12", 
                type: "Corporativo", 
                value: 3750000, 
                rate: 14.2, 
                status: "Em Atraso", 
                progress: 45, 
                startDate: "10/01/2022", 
                endDate: "10/01/2026", 
                paidValue: 1687500, 
                remainingValue: 2062500, 
                nextPaymentDate: "20/07/2023", 
                installmentValue: 62500, 
                riskScore: 60, 
                documents: [], 
                alerts: ["Atraso de pagamento detectado"], 
                serasaRating: "BB",
                collateral: [
                    { type: "Equipamentos", value: 4200000, description: "Maquinário Industrial" }
                ],
                covenants: [
                    { type: "Endividamento Líquido/EBITDA", limit: 3.5, current: 4.1, status: "BREACH" },
                    { type: "Cobertura de Juros", limit: 1.5, current: 1.2, status: "BREACH" }
                ],
                carenceDays: 10,
                curePeriod: 45,
                sector: "Construção Civil",
                pdd: 8.5,
                recoveryRate: 65
            },
            { 
                id: "#CR-7843", 
                client: "Indústrias Silva Ltda.", 
                cnpj: "45.678.901/0001-23", 
                type: "Industrial", 
                value: 2100000, 
                rate: 13.8, 
                status: "Inadimplente", 
                progress: 30, 
                startDate: "01/02/2022", 
                endDate: "01/02/2025", 
                paidValue: 630000, 
                remainingValue: 1470000, 
                nextPaymentDate: "30/07/2023", 
                installmentValue: 43750, 
                riskScore: 40, 
                documents: [], 
                alerts: ["Inadimplência confirmada", "Risco de vencimento antecipado"], 
                serasaRating: "CC",
                collateral: [
                    { type: "Estoque", value: 1200000, description: "Matéria-prima e produtos acabados" }
                ],
                covenants: [
                    { type: "Endividamento Líquido/EBITDA", limit: 3.5, current: 6.2, status: "BREACH" },
                    { type: "Patrimônio Líquido Mínimo", limit: 5000000, current: 3200000, status: "BREACH" }
                ],
                carenceDays: 5,
                curePeriod: 15,
                sector: "Indústria",
                pdd: 25.5,
                recoveryRate: 45
            },
            { 
                id: "#CR-7842", 
                client: "Tech Solutions S.A.", 
                cnpj: "67.890.123/0001-34", 
                type: "Tecnologia", 
                value: 850000, 
                rate: 15.5, 
                status: "Adimplente", 
                progress: 90, 
                startDate: "20/04/2022", 
                endDate: "20/04/2024", 
                paidValue: 765000, 
                remainingValue: 85000, 
                nextPaymentDate: "10/07/2023", 
                installmentValue: 21250, 
                riskScore: 90, 
                documents: [], 
                alerts: [], 
                serasaRating: "AAA",
                collateral: [
                    { type: "Recebíveis", value: 1100000, description: "Contratos futuros de tecnologia" }
                ],
                covenants: [
                    { type: "Crescimento Receita Anual", limit: 15, current: 22, status: "OK" },
                    { type: "Cobertura de Juros", limit: 2.0, current: 4.5, status: "OK" }
                ],
                carenceDays: 30,
                curePeriod: 60,
                sector: "Tecnologia",
                pdd: 0.5,
                recoveryRate: 95
            },
            { 
                id: "#CR-7841", 
                client: "Agro Forte Ltda.", 
                cnpj: "89.012.345/0001-45", 
                type: "Agronegócio", 
                value: 1750000, 
                rate: 11.9, 
                status: "Adimplente", 
                progress: 60, 
                startDate: "05/05/2022", 
                endDate: "05/05/2028", 
                paidValue: 1050000, 
                remainingValue: 700000, 
                nextPaymentDate: "25/07/2023", 
                installmentValue: 29167, 
                riskScore: 85, 
                documents: [], 
                alerts: [], 
                serasaRating: "AA",
                collateral: [
                    { type: "Safra Futura", value: 2500000, description: "Produção de soja 2024/2025" },
                    { type: "Terras", value: 5000000, description: "1.500 hectares - Mato Grosso" }
                ],
                covenants: [
                    { type: "Produtividade Mínima", limit: 50, current: 58, status: "OK" },
                    { type: "Seguro Rural", limit: 80, current: 100, status: "OK" }
                ],
                carenceDays: 60,
                curePeriod: 90,
                sector: "Agronegócio",
                pdd: 2.1,
                recoveryRate: 78
            }
        ];

        // Histórico de pagamentos expandido
        const paymentHistory = {
            "#CR-7845": [
                { date: "15/06/2023", value: 26042, status: "Pago", receipt: "#REC001", days: 0 },
                { date: "15/05/2023", value: 26042, status: "Pago", receipt: "#REC002", days: 0 },
                { date: "15/04/2023", value: 26042, status: "Pago", receipt: "#REC003", days: 2 },
                { date: "15/03/2023", value: 26042, status: "Pago", receipt: "#REC004", days: 0 },
            ],
            "#CR-7844": [
                { date: "20/06/2023", value: 62500, status: "Atrasado", receipt: "", days: 15 },
                { date: "20/05/2023", value: 62500, status: "Pago", receipt: "#REC005", days: 8 },
                { date: "20/04/2023", value: 62500, status: "Pago", receipt: "#REC006", days: 3 },
            ],
            "#CR-7843": [
                { date: "30/06/2023", value: 43750, status: "Inadimplente", receipt: "", days: 45 },
                { date: "30/05/2023", value: 43750, status: "Inadimplente", receipt: "", days: 60 },
            ]
        };

        // Políticas de crédito configuráveis
        const defaultPolicies = {
            minScore: 70,
            maxExposure: 5000000,
            minCollateralCoverage: 120,
            maxDebtToEbitda: 3.5,
            minInterestCoverage: 1.5,
            approvalWorkflow: [
                { amount: 1000000, approvers: 1, roles: ["Gerente"] },
                { amount: 2000000, approvers: 2, roles: ["Gerente", "Diretor"] },
                { amount: 5000000, approvers: 3, roles: ["Gerente", "Diretor", "CEO"] }
            ]
        };

        const CreditMonitoringSystem = () => {
            const [selectedCredit, setSelectedCredit] = useState(null);
            const [activeTab, setActiveTab] = useState("dashboard");
            const [statusFilter, setStatusFilter] = useState("Todos os Status");
            const [periodFilter, setPeriodFilter] = useState("Últimos 30 dias");
            const [operationFilter, setOperationFilter] = useState("Todas as Operações");
            const [filteredCredits, setFilteredCredits] = useState(creditData);
            const [currentPage, setCurrentPage] = useState(1);
            const [uploadedDocuments, setUploadedDocuments] = useState({});
            const [dossierNotes, setDossierNotes] = useState("");
            const [showPolicyModal, setShowPolicyModal] = useState(false);
            const [policies, setPolicies] = useState(defaultPolicies);
            const [showBalanceUpload, setShowBalanceUpload] = useState(false);
            const [balanceData, setBalanceData] = useState({});
            const creditsPerPage = 5;

            const performanceChartRef = useRef(null);
            const distributionChartRef = useRef(null);
            const behaviorChartRef = useRef(null);
            const riskChartRef = useRef(null);

            // Filtros e paginação
            useEffect(() => {
                let filtered = creditData;
                if (statusFilter !== "Todos os Status") {
                    filtered = filtered.filter(credit => credit.status === statusFilter);
                }
                if (periodFilter !== "Últimos 30 dias") {
                    filtered = filtered.filter(credit => {
                        const startDate = new Date(credit.startDate.split("/").reverse().join("-"));
                        const now = new Date();
                        const daysDiff = (now - startDate) / (1000 * 60 * 60 * 24);
                        if (periodFilter === "Últimos 60 dias") return daysDiff <= 60;
                        if (periodFilter === "Últimos 90 dias") return daysDiff <= 90;
                        return true;
                    });
                }
                if (operationFilter !== "Todas as Operações") {
                    filtered = filtered.filter(credit => credit.type === operationFilter);
                }
                setFilteredCredits(filtered);
                setCurrentPage(1);
            }, [statusFilter, periodFilter, operationFilter]);

            // Inicialização dos gráficos
            useEffect(() => {
                if (activeTab === "dashboard") {
                    initializeCharts();
                }
                return () => {
                    [performanceChartRef, distributionChartRef, behaviorChartRef, riskChartRef].forEach(ref => {
                        if (ref.current) ref.current.destroy();
                    });
                };
            }, [activeTab]);

            const initializeCharts = () => {
                // Gráfico de Performance
                const performanceCtx = document.getElementById('creditPerformanceChart')?.getContext('2d');
                if (performanceCtx) {
                    performanceChartRef.current = new Chart(performanceCtx, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                            datasets: [
                                {
                                    label: 'Créditos Emitidos',
                                    data: [2.5, 3.2, 3.5, 4.1, 4.8, 5.2, 6.1, 6.8, 7.5, 8.2, 9.1, 10.5],
                                    borderColor: '#343E83',
                                    backgroundColor: 'rgba(52, 62, 131, 0.1)',
                                    tension: 0.4,
                                    fill: true,
                                },
                                {
                                    label: 'Pagamentos Recebidos',
                                    data: [1.8, 2.3, 2.8, 3.2, 3.9, 4.5, 5.2, 5.8, 6.3, 7.1, 7.8, 8.5],
                                    borderColor: '#32BECB',
                                    backgroundColor: 'rgba(50, 190, 203, 0.1)',
                                    tension: 0.4,
                                    fill: true,
                                },
                            ],
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: { y: { beginAtZero: true, ticks: { callback: value => `R$ ${value}M` } } },
                            plugins: { tooltip: { callbacks: { label: context => `${context.dataset.label}: R$ ${context.raw}M` } } },
                        },
                    });
                }

                // Gráfico de Distribuição
                const distributionCtx = document.getElementById('creditDistributionChart')?.getContext('2d');
                if (distributionCtx) {
                    distributionChartRef.current = new Chart(distributionCtx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Imobiliário', 'Corporativo', 'Industrial', 'Agronegócio', 'Tecnologia'],
                            datasets: [{
                                data: [35, 25, 20, 15, 5],
                                backgroundColor: ['#343E83', '#32BECB', '#5DACCD', '#9E36EF', '#7A8FFF'],
                                borderWidth: 0,
                            }],
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { position: 'right' }, tooltip: { callbacks: { label: context => `${context.label}: ${context.raw}%` } } },
                        },
                    });
                }

                // Gráfico de Comportamento de Pagamento
                const behaviorCtx = document.getElementById('paymentBehaviorChart')?.getContext('2d');
                if (behaviorCtx) {
                    behaviorChartRef.current = new Chart(behaviorCtx, {
                        type: 'bar',
                        data: {
                            labels: ['0 dias', '1-7 dias', '8-15 dias', '16-30 dias', '31+ dias'],
                            datasets: [{
                                label: 'Pagamentos',
                                data: [85, 10, 3, 1.5, 0.5],
                                backgroundColor: ['#10b981', '#f59e0b', '#f59e0b', '#ef4444', '#dc2626'],
                            }],
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: { y: { beginAtZero: true, ticks: { callback: value => `${value}%` } } },
                        },
                    });
                }

                // Gráfico de Risco por Setor
                const riskCtx = document.getElementById('sectorRiskChart')?.getContext('2d');
                if (riskCtx) {
                    riskChartRef.current = new Chart(riskCtx, {
                        type: 'radar',
                        data: {
                            labels: ['Construção Civil', 'Tecnologia', 'Indústria', 'Agronegócio'],
                            datasets: [{
                                label: 'Risco Médio (%)',
                                data: [15.2, 5.8, 22.1, 8.9],
                                backgroundColor: 'rgba(158, 54, 239, 0.2)',
                                borderColor: '#9E36EF',
                                pointBackgroundColor: '#9E36EF',
                            }],
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: 30,
                                    ticks: { callback: value => `${value}%` }
                                }
                            },
                        },
                    });
                }
            };

            // Funções de análise
            const calculateRealTimeScore = (credit) => {
                let score = credit.riskScore;
                
                // Ajuste baseado no histórico de pagamentos
                const history = paymentHistory[credit.id] || [];
                const avgDelay = history.reduce((acc, payment) => acc + payment.days, 0) / history.length || 0;
                score -= avgDelay * 2;

                // Ajuste baseado em covenants
                const breachedCovenants = credit.covenants?.filter(c => c.status === "BREACH").length || 0;
                score -= breachedCovenants * 15;

                // Ajuste baseado no valor das garantias
                const totalCollateral = credit.collateral?.reduce((acc, col) => acc + col.value, 0) || 0;
                const collateralRatio = totalCollateral / credit.value;
                if (collateralRatio < 1) score -= 10;
                if (collateralRatio > 1.5) score += 5;

                return Math.max(Math.min(Math.round(score), 100), 0);
            };

            const checkEarlyMaturityTriggers = (credit) => {
                const triggers = [];
                
                // Verificar inadimplência
                if (credit.status === "Inadimplente") {
                    triggers.push("Inadimplência confirmada");
                }

                // Verificar covenant breaches
                const breachedCovenants = credit.covenants?.filter(c => c.status === "BREACH") || [];
                breachedCovenants.forEach(covenant => {
                    triggers.push(`Covenant violado: ${covenant.type}`);
                });

                // Verificar deterioração de score
                const currentScore = calculateRealTimeScore(credit);
                if (currentScore < 50) {
                    triggers.push("Score de crédito crítico");
                }

                // Verificar garantias insuficientes
                const totalCollateral = credit.collateral?.reduce((acc, col) => acc + col.value, 0) || 0;
                const collateralRatio = totalCollateral / credit.remainingValue;
                if (collateralRatio < 1.1) {
                    triggers.push("Garantias insuficientes");
                }

                return triggers;
            };

            const calculateAcceleratedValue = (credit) => {
                const principal = credit.remainingValue;
                const interestRate = credit.rate / 100;
                const remainingMonths = new Date(credit.endDate.split("/").reverse().join("-")).getTime() - new Date().getTime();
                const months = Math.max(remainingMonths / (1000 * 60 * 60 * 24 * 30), 0);
                
                // Juros de mora (2% ao mês)
                const lateFee = principal * 0.02;
                
                // Multa contratual (10%)
                const penalty = principal * 0.10;
                
                // Juros futuros descontados
                const futureInterest = principal * interestRate * (months / 12) * 0.7; // 70% dos juros futuros
                
                return principal + lateFee + penalty + futureInterest;
            };

            const analyzeDocument = (file, creditId) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const content = e.target.result.toLowerCase();
                    const alerts = [];

                    const keywords = [
                        "inadimplemento", "inadimplência", "vencimento antecipado",
                        "descumprimento", "protesto", "falência", "liquidação judicial",
                        "execução", "rescisão contratual", "prazo de cura", "covenant",
                        "garantia", "colateral", "penhor", "hipoteca"
                    ];

                    keywords.forEach(kw => {
                        if (content.includes(kw)) {
                            alerts.push(`Cláusula sensível detectada: "${kw}"`);
                        }
                    });

                    if (content.includes("fraude") || content.includes("lavagem de dinheiro")) {
                        alerts.push("⚠️ Padrão suspeito: possível fraude ou lavagem de dinheiro");
                    }

                    // Análise de balanço (simulada)
                    if (file.name.toLowerCase().includes("balanço") || file.name.toLowerCase().includes("balance")) {
                        const credit = creditData.find(c => c.id === creditId);
                        if (credit) {
                            // Simular análise de indicadores
                            const mockIndicators = {
                                liquidezCorrente: Math.random() * 2 + 0.5,
                                endividamento: Math.random() * 0.8 + 0.2,
                                roe: Math.random() * 0.3 - 0.1
                            };

                            if (mockIndicators.liquidezCorrente < 1) {
                                alerts.push("Liquidez corrente abaixo de 1.0");
                            }
                            if (mockIndicators.endividamento > 0.6) {
                                alerts.push("Endividamento elevado");
                            }
                            if (mockIndicators.roe < 0) {
                                alerts.push("ROE negativo");
                            }

                            setBalanceData(prev => ({
                                ...prev,
                                [creditId]: mockIndicators
                            }));
                        }
                    }

                    setUploadedDocuments(prev => ({
                        ...prev,
                        [creditId]: [...(prev[creditId] || []), { name: file.name, content, alerts }],
                    }));

                    // Atualizar alertas do crédito
                    setFilteredCredits(prevCredits =>
                        prevCredits.map(credit =>
                            credit.id === creditId ? {
                                ...credit,
                                alerts: [...credit.alerts, ...alerts]
                            } : credit
                        )
                    );
                };
                reader.readAsText(file);
            };

            const handleFileUpload = (e, creditId) => {
                const files = Array.from(e.target.files);
                files.forEach(file => analyzeDocument(file, creditId));
            };

            const exportToCSV = (data, filename) => {
                const headers = Object.keys(data[0]).join(',');
                const rows = data.map(row => Object.values(row).join(','));
                const csv = [headers, ...rows].join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            };

            const generateCVMReport = () => {
                const reportData = creditData.map(credit => ({
                    ID: credit.id,
                    Cliente: credit.client,
                    CNPJ: credit.cnpj,
                    Valor: credit.value,
                    Status: credit.status,
                    RiskScore: calculateRealTimeScore(credit),
                    PDD: credit.pdd,
                    Setor: credit.sector,
                    Vencimento: credit.endDate
                }));
                
                exportToCSV(reportData, 'relatorio_cvm.csv');
            };

            const formatCurrency = (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);

            const indexOfLastCredit = currentPage * creditsPerPage;
            const indexOfFirstCredit = indexOfLastCredit - creditsPerPage;
            const currentCredits = filteredCredits.slice(indexOfFirstCredit, indexOfLastCredit);
            const totalPages = Math.ceil(filteredCredits.length / creditsPerPage);

            // Cálculos para KPIs
            const totalCredits = creditData.reduce((acc, credit) => acc + credit.value, 0);
            const totalPDD = creditData.reduce((acc, credit) => acc + (credit.value * credit.pdd / 100), 0);
            const avgRecoveryRate = creditData.reduce((acc, credit) => acc + credit.recoveryRate, 0) / creditData.length;
            const avgDelayDays = Object.values(paymentHistory).flat().reduce((acc, payment) => acc + payment.days, 0) / Object.values(paymentHistory).flat().length;

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <header className="bg-white border-b border-gray-200 sticky top-0 z-40">
                        <div className="container mx-auto px-4">
                            <div className="flex justify-between items-center h-16">
                                <div className="flex items-center space-x-4">
                                    <div className="gradient-bg w-10 h-10 rounded-lg flex items-center justify-center">
                                        <span className="text-white font-bold text-lg">SC</span>
                                    </div>
                                    <h1 className="text-xl font-bold text-gray-800">SecuriCredit Monitor</h1>
                                </div>
                                <nav className="flex space-x-6">
                                    <button 
                                        className={`px-4 py-2 rounded-md transition ${activeTab === 'dashboard' ? 'bg-[#343E83] text-white' : 'text-gray-600 hover:text-gray-800'}`}
                                        onClick={() => setActiveTab('dashboard')}
                                    >
                                        Dashboard
                                    </button>
                                    <button 
                                        className={`px-4 py-2 rounded-md transition ${activeTab === 'credits' ? 'bg-[#343E83] text-white' : 'text-gray-600 hover:text-gray-800'}`}
                                        onClick={() => setActiveTab('credits')}
                                    >
                                        Créditos
                                    </button>
                                    <button 
                                        className={`px-4 py-2 rounded-md transition ${activeTab === 'analysis' ? 'bg-[#343E83] text-white' : 'text-gray-600 hover:text-gray-800'}`}
                                        onClick={() => setActiveTab('analysis')}
                                    >
                                        Análise
                                    </button>
                                    <button 
                                        className={`px-4 py-2 rounded-md transition ${activeTab === 'rules' ? 'bg-[#343E83] text-white' : 'text-gray-600 hover:text-gray-800'}`}
                                        onClick={() => setActiveTab('rules')}
                                    >
                                        Regras
                                    </button>
                                    <button 
                                        className={`px-4 py-2 rounded-md transition ${activeTab === 'compliance' ? 'bg-[#343E83] text-white' : 'text-gray-600 hover:text-gray-800'}`}
                                        onClick={() => setActiveTab('compliance')}
                                    >
                                        Compliance
                                    </button>
                                </nav>
                            </div>
                        </div>
                    </header>

                    <main className="container mx-auto px-4 py-6">
                        {/* Dashboard Tab */}
                        {activeTab === 'dashboard' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">Dashboard Executivo</h2>
                                    <div className="flex space-x-2">
                                        <button 
                                            className="px-4 py-2 bg-[#343E83] text-white rounded-md hover:bg-opacity-90 transition flex items-center"
                                            onClick={generateCVMReport}
                                        >
                                            <svg className="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                            </svg>
                                            Relatório CVM
                                        </button>
                                        <button className="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition flex items-center">
                                            <svg className="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                            </svg>
                                            Exportar
                                        </button>
                                    </div>
                                </div>

                                {/* KPIs Expandidos */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-6">
                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100 hover:shadow-lg transition-transform hover:-translate-y-1">
                                        <div className="flex justify-between">
                                            <div>
                                                <p className="text-sm text-gray-500 mb-1">Total de Créditos</p>
                                                <h3 className="text-2xl font-bold text-gray-800">{formatCurrency(totalCredits)}</h3>
                                                <p className="text-xs text-green-500 mt-2 flex items-center">
                                                    <svg className="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                                                    </svg>
                                                    +8.2% desde o mês passado
                                                </p>
                                            </div>
                                            <div className="w-12 h-12 rounded-full bg-[#343E83] bg-opacity-10 flex items-center justify-center">
                                                <svg className="h-6 w-6 text-[#343E83]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100 hover:shadow-lg transition-transform hover:-translate-y-1">
                                        <div className="flex justify-between">
                                            <div>
                                                <p className="text-sm text-gray-500 mb-1">PDD Total</p>
                                                <h3 className="text-2xl font-bold text-gray-800">{formatCurrency(totalPDD)}</h3>
                                                <p className="text-xs text-red-500 mt-2 flex items-center">
                                                    <svg className="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                                                    </svg>
                                                    +0.5% desde o mês passado
                                                </p>
                                            </div>
                                            <div className="w-12 h-12 rounded-full bg-[#32BECB] bg-opacity-10 flex items-center justify-center">
                                                <svg className="h-6 w-6 text-[#32BECB]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100 hover:shadow-lg transition-transform hover:-translate-y-1">
                                        <div className="flex justify-between">
                                            <div>
                                                <p className="text-sm text-gray-500 mb-1">Recovery Rate</p>
                                                <h3 className="text-2xl font-bold text-gray-800">{avgRecoveryRate.toFixed(1)}%</h3>
                                                <p className="text-xs text-green-500 mt-2 flex items-center">
                                                    <svg className="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                                                    </svg>
                                                    +3.2% desde o mês passado
                                                </p>
                                            </div>
                                            <div className="w-12 h-12 rounded-full bg-[#5DACCD] bg-opacity-10 flex items-center justify-center">
                                                <svg className="h-6 w-6 text-[#5DACCD]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100 hover:shadow-lg transition-transform hover:-translate-y-1">
                                        <div className="flex justify-between">
                                            <div>
                                                <p className="text-sm text-gray-500 mb-1">Atraso Médio</p>
                                                <h3 className="text-2xl font-bold text-gray-800">{avgDelayDays.toFixed(0)} dias</h3>
                                                <p className="text-xs text-yellow-500 mt-2 flex items-center">
                                                    <svg className="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    Estável
                                                </p>
                                            </div>
                                            <div className="w-12 h-12 rounded-full bg-[#9E36EF] bg-opacity-10 flex items-center justify-center">
                                                <svg className="h-6 w-6 text-[#9E36EF]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100 hover:shadow-lg transition-transform hover:-translate-y-1">
                                        <div className="flex justify-between">
                                            <div>
                                                <p className="text-sm text-gray-500 mb-1">Créditos Ativos</p>
                                                <h3 className="text-2xl font-bold text-gray-800">{creditData.length}</h3>
                                                <p className="text-xs text-green-500 mt-2 flex items-center">
                                                    <svg className="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                                                    </svg>
                                                    +2 novos este mês
                                                </p>
                                            </div>
                                            <div className="w-12 h-12 rounded-full bg-[#7A8FFF] bg-opacity-10 flex items-center justify-center">
                                                <svg className="h-6 w-6 text-[#7A8FFF]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Gráficos Expandidos */}
                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="font-semibold text-gray-800">Desempenho de Crédito</h3>
                                            <div className="flex space-x-2">
                                                <button className="px-3 py-1 text-sm bg-gray-100 rounded-md hover:bg-gray-200">Mensal</button>
                                                <button className="px-3 py-1 text-sm bg-[#343E83] text-white rounded-md">Anual</button>
                                            </div>
                                        </div>
                                        <div className="h-64">
                                            <canvas id="creditPerformanceChart"></canvas>
                                        </div>
                                    </div>

                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="font-semibold text-gray-800">Distribuição por Tipo de Crédito</h3>
                                        </div>
                                        <div className="h-64">
                                            <canvas id="creditDistributionChart"></canvas>
                                        </div>
                                    </div>

                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="font-semibold text-gray-800">Comportamento de Pagamento</h3>
                                        </div>
                                        <div className="h-64">
                                            <canvas id="paymentBehaviorChart"></canvas>
                                        </div>
                                    </div>

                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                                        <div className="flex justify-between items-center mb-4">
                                            <h3 className="font-semibold text-gray-800">Risco Médio por Setor</h3>
                                        </div>
                                        <div className="h-64">
                                            <canvas id="sectorRiskChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Credits Tab */}
                        {activeTab === 'credits' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">Gestão de Créditos</h2>
                                    <div className="flex space-x-2">
                                        <button className="px-4 py-2 bg-[#343E83] text-white rounded-md hover:bg-opacity-90 transition flex items-center">
                                            <svg className="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 4v16m8-8H4" />
                                            </svg>
                                            Novo Crédito
                                        </button>
                                        <button 
                                            className="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition flex items-center"
                                            onClick={() => setShowBalanceUpload(true)}
                                        >
                                            <svg className="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10" />
                                            </svg>
                                            Upload Balanço
                                        </button>
                                    </div>
                                </div>

                                {/* Filtros */}
                                <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100 mb-6">
                                    <div className="flex flex-wrap gap-4">
                                        <select className="pl-3 pr-8 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#343E83]" onChange={e => setStatusFilter(e.target.value)}>
                                            <option>Todos os Status</option>
                                            <option>Adimplente</option>
                                            <option>Inadimplente</option>
                                            <option>Em Atraso</option>
                                        </select>
                                        <select className="pl-3 pr-8 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#343E83]" onChange={e => setPeriodFilter(e.target.value)}>
                                            <option>Últimos 30 dias</option>
                                            <option>Últimos 60 dias</option>
                                            <option>Últimos 90 dias</option>
                                        </select>
                                        <select className="pl-3 pr-8 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#343E83]" onChange={e => setOperationFilter(e.target.value)}>
                                            <option>Todas as Operações</option>
                                            <option>Imobiliário</option>
                                            <option>Corporativo</option>
                                            <option>Industrial</option>
                                            <option>Agronegócio</option>
                                            <option>Tecnologia</option>
                                        </select>
                                    </div>
                                </div>

                                {/* Tabela de Créditos */}
                                <div className="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full divide-y divide-gray-200">
                                            <thead className="bg-gray-50">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Triggers</th>
                                                    <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {currentCredits.map(credit => {
                                                    const realTimeScore = calculateRealTimeScore(credit);
                                                    const triggers = checkEarlyMaturityTriggers(credit);
                                                    
                                                    return (
                                                        <tr key={credit.id} className="hover:bg-gray-50 transition">
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{credit.id}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{credit.client}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{credit.type}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{formatCurrency(credit.value)}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                                <div className="flex items-center">
                                                                    <span className={`risk-indicator ${realTimeScore >= 70 ? 'risk-low' : realTimeScore >= 50 ? 'risk-medium' : 'risk-high'}`}></span>
                                                                    {realTimeScore}
                                                                </div>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${credit.status === 'Adimplente' ? 'bg-green-100 text-green-800' : credit.status === 'Em Atraso' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}`}>
                                                                    {credit.status}
                                                                </span>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                                {triggers.length > 0 ? (
                                                                    <span className="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full">
                                                                        {triggers.length} trigger(s)
                                                                    </span>
                                                                ) : (
                                                                    <span className="text-green-600">OK</span>
                                                                )}
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                                                                <button className="text-[#343E83] hover:text-[#2a326b] mr-3" onClick={() => setSelectedCredit(credit)}>
                                                                    Detalhes
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    );
                                                })}
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    {/* Paginação */}
                                    <div className="px-6 py-4 border-t border-gray-100 flex items-center justify-between">
                                        <div className="text-sm text-gray-500">
                                            Mostrando <span className="font-medium">{indexOfFirstCredit + 1}</span> a <span className="font-medium">{Math.min(indexOfLastCredit, filteredCredits.length)}</span> de <span className="font-medium">{filteredCredits.length}</span> resultados
                                        </div>
                                        <div className="flex space-x-2">
                                            <button className="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-500 hover:bg-gray-50 disabled:opacity-50" disabled={currentPage === 1} onClick={() => setCurrentPage(currentPage - 1)}>
                                                Anterior
                                            </button>
                                            {[...Array(totalPages)].map((_, i) => (
                                                <button key={i} className={`px-3 py-1 border border-gray-300 rounded-md text-sm ${currentPage === i + 1 ? 'bg-[#343E83] text-white' : 'text-gray-500 hover:bg-gray-50'}`} onClick={() => setCurrentPage(i + 1)}>
                                                    {i + 1}
                                                </button>
                                            ))}
                                            <button className="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-500 hover:bg-gray-50 disabled:opacity-50" disabled={currentPage === totalPages} onClick={() => setCurrentPage(currentPage + 1)}>
                                                Próximo
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Analysis Tab */}
                        {activeTab === 'analysis' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">Módulo de Análise Avançada</h2>
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {/* Score em Tempo Real */}
                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                                        <h3 className="font-semibold text-gray-800 mb-4">Score de Crédito em Tempo Real</h3>
                                        <div className="space-y-4">
                                            {creditData.map(credit => {
                                                const realTimeScore = calculateRealTimeScore(credit);
                                                return (
                                                    <div key={credit.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-md">
                                                        <div>
                                                            <span className="font-medium">{credit.client}</span>
                                                            <span className="text-sm text-gray-500 ml-2">{credit.id}</span>
                                                        </div>
                                                        <div className="flex items-center">
                                                            <span className={`risk-indicator ${realTimeScore >= 70 ? 'risk-low' : realTimeScore >= 50 ? 'risk-medium' : 'risk-high'}`}></span>
                                                            <span className="font-bold">{realTimeScore}</span>
                                                            <span className="text-sm text-gray-500 ml-2">
                                                                ({credit.riskScore > realTimeScore ? '-' : '+'}{Math.abs(credit.riskScore - realTimeScore)})
                                                            </span>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>

                                    {/* Triggers de Vencimento Antecipado */}
                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                                        <h3 className="font-semibold text-gray-800 mb-4">Triggers de Vencimento Antecipado</h3>
                                        <div className="space-y-4">
                                            {creditData.map(credit => {
                                                const triggers = checkEarlyMaturityTriggers(credit);
                                                const acceleratedValue = calculateAcceleratedValue(credit);
                                                return (
                                                    <div key={credit.id} className={`p-4 rounded-md border ${triggers.length > 0 ? 'border-red-200 bg-red-50' : 'border-green-200 bg-green-50'}`}>
                                                        <div className="flex justify-between items-start mb-2">
                                                            <div>
                                                                <span className="font-medium">{credit.client}</span>
                                                                <span className="text-sm text-gray-500 ml-2">{credit.id}</span>
                                                            </div>
                                                            {triggers.length > 0 && (
                                                                <span className="px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full">
                                                                    {triggers.length} trigger(s)
                                                                </span>
                                                            )}
                                                        </div>
                                                        {triggers.length > 0 ? (
                                                            <div>
                                                                <ul className="text-sm text-red-700 mb-2">
                                                                    {triggers.map((trigger, index) => (
                                                                        <li key={index} className="flex items-center">
                                                                            <svg className="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                                            </svg>
                                                                            {trigger}
                                                                        </li>
                                                                    ))}
                                                                </ul>
                                                                <div className="text-sm">
                                                                    <span className="text-gray-600">Valor Acelerado: </span>
                                                                    <span className="font-bold text-red-600">{formatCurrency(acceleratedValue)}</span>
                                                                    <span className="text-gray-500 ml-2">
                                                                        (+{((acceleratedValue - credit.remainingValue) / credit.remainingValue * 100).toFixed(1)}%)
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        ) : (
                                                            <p className="text-sm text-green-700">Sem triggers ativos</p>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>

                                    {/* Monitoramento de Covenants */}
                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100 lg:col-span-2">
                                        <h3 className="font-semibold text-gray-800 mb-4">Monitoramento de Covenants Financeiros</h3>
                                        <div className="overflow-x-auto">
                                            <table className="min-w-full divide-y divide-gray-200">
                                                <thead className="bg-gray-50">
                                                    <tr>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cliente</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Covenant</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Limite</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Atual</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Margem</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="bg-white divide-y divide-gray-200">
                                                    {creditData.map(credit => 
                                                        credit.covenants?.map((covenant, index) => (
                                                            <tr key={`${credit.id}-${index}`}>
                                                                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                                    {credit.client}
                                                                </td>
                                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                                    {covenant.type}
                                                                </td>
                                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                                    {covenant.limit}
                                                                </td>
                                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                                    {covenant.current}
                                                                </td>
                                                                <td className="px-6 py-4 whitespace-nowrap">
                                                                    <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${covenant.status === 'OK' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                                                        {covenant.status}
                                                                    </span>
                                                                </td>
                                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                                    {covenant.status === 'OK' ? 
                                                                        <span className="text-green-600">
                                                                            {((covenant.limit - covenant.current) / covenant.limit * 100).toFixed(1)}%
                                                                        </span> : 
                                                                        <span className="text-red-600">
                                                                            -{((covenant.current - covenant.limit) / covenant.limit * 100).toFixed(1)}%
                                                                        </span>
                                                                    }
                                                                </td>
                                                            </tr>
                                                        ))
                                                    )}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Rules Tab */}
                        {activeTab === 'rules' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">Motor de Regras</h2>
                                    <button 
                                        className="px-4 py-2 bg-[#343E83] text-white rounded-md hover:bg-opacity-90 transition"
                                        onClick={() => setShowPolicyModal(true)}
                                    >
                                        Configurar Políticas
                                    </button>
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {/* Políticas Atuais */}
                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                                        <h3 className="font-semibold text-gray-800 mb-4">Políticas de Crédito</h3>
                                        <div className="space-y-4">
                                            <div className="flex justify-between items-center p-3 bg-gray-50 rounded-md">
                                                <span className="text-sm font-medium">Score Mínimo</span>
                                                <span className="font-bold">{policies.minScore}</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-gray-50 rounded-md">
                                                <span className="text-sm font-medium">Exposição Máxima</span>
                                                <span className="font-bold">{formatCurrency(policies.maxExposure)}</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-gray-50 rounded-md">
                                                <span className="text-sm font-medium">Cobertura de Garantia Mín.</span>
                                                <span className="font-bold">{policies.minCollateralCoverage}%</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-gray-50 rounded-md">
                                                <span className="text-sm font-medium">Dívida/EBITDA Máx.</span>
                                                <span className="font-bold">{policies.maxDebtToEbitda}x</span>
                                            </div>
                                            <div className="flex justify-between items-center p-3 bg-gray-50 rounded-md">
                                                <span className="text-sm font-medium">Cobertura de Juros Mín.</span>
                                                <span className="font-bold">{policies.minInterestCoverage}x</span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Workflow de Aprovação */}
                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                                        <h3 className="font-semibold text-gray-800 mb-4">Workflow de Aprovação</h3>
                                        <div className="space-y-4">
                                            {policies.approvalWorkflow.map((workflow, index) => (
                                                <div key={index} className="border border-gray-200 rounded-md p-4">
                                                    <div className="flex justify-between items-center mb-2">
                                                        <span className="font-medium">Até {formatCurrency(workflow.amount)}</span>
                                                        <span className="text-sm text-gray-500">{workflow.approvers} aprovador(es)</span>
                                                    </div>
                                                    <div className="flex flex-wrap gap-2">
                                                        {workflow.roles.map((role, roleIndex) => (
                                                            <span key={roleIndex} className="px-2 py-1 bg-[#343E83] bg-opacity-10 text-[#343E83] text-xs rounded-full">
                                                                {role}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Simulação de Integração */}
                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100 lg:col-span-2">
                                        <h3 className="font-semibold text-gray-800 mb-4">Status das Integrações</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                            <div className="border border-gray-200 rounded-md p-4">
                                                <div className="flex items-center justify-between mb-2">
                                                    <span className="font-medium">Bacen (SCR/CCS)</span>
                                                    <span className="w-3 h-3 bg-green-500 rounded-full"></span>
                                                </div>
                                                <p className="text-sm text-gray-600">Última sincronização: 2h atrás</p>
                                                <button className="mt-2 text-sm text-[#343E83] hover:underline">Sincronizar agora</button>
                                            </div>
                                            <div className="border border-gray-200 rounded-md p-4">
                                                <div className="flex items-center justify-between mb-2">
                                                    <span className="font-medium">Serasa Experian</span>
                                                    <span className="w-3 h-3 bg-green-500 rounded-full"></span>
                                                </div>
                                                <p className="text-sm text-gray-600">API ativa - 47 consultas hoje</p>
                                                <button className="mt-2 text-sm text-[#343E83] hover:underline">Configurar</button>
                                            </div>
                                            <div className="border border-gray-200 rounded-md p-4">
                                                <div className="flex items-center justify-between mb-2">
                                                    <span className="font-medium">CRM/ERP</span>
                                                    <span className="w-3 h-3 bg-yellow-500 rounded-full"></span>
                                                </div>
                                                <p className="text-sm text-gray-600">Conexão instável</p>
                                                <button className="mt-2 text-sm text-[#343E83] hover:underline">Reconectar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Compliance Tab */}
                        {activeTab === 'compliance' && (
                            <div>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">Compliance e Governança</h2>
                                    <div className="flex space-x-2">
                                        <button 
                                            className="px-4 py-2 bg-[#343E83] text-white rounded-md hover:bg-opacity-90 transition"
                                            onClick={generateCVMReport}
                                        >
                                            Relatório CVM
                                        </button>
                                        <button className="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50 transition">
                                            Auditoria
                                        </button>
                                    </div>
                                </div>

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {/* Logs de Auditoria */}
                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                                        <h3 className="font-semibold text-gray-800 mb-4">Logs de Auditoria</h3>
                                        <div className="space-y-3">
                                            <div className="flex items-center justify-between p-3 border border-gray-200 rounded-md">
                                                <div>
                                                    <span className="text-sm font-medium">João Silva</span>
                                                    <p className="text-xs text-gray-500">Alterou limite de crédito #CR-7845</p>
                                                </div>
                                                <span className="text-xs text-gray-400">2h atrás</span>
                                            </div>
                                            <div className="flex items-center justify-between p-3 border border-gray-200 rounded-md">
                                                <div>
                                                    <span className="text-sm font-medium">Maria Santos</span>
                                                    <p className="text-xs text-gray-500">Aprovou operação #CR-7846</p>
                                                </div>
                                                <span className="text-xs text-gray-400">4h atrás</span>
                                            </div>
                                            <div className="flex items-center justify-between p-3 border border-gray-200 rounded-md">
                                                <div>
                                                    <span className="text-sm font-medium">Carlos Oliveira</span>
                                                    <p className="text-xs text-gray-500">Executou vencimento antecipado #CR-7843</p>
                                                </div>
                                                <span className="text-xs text-gray-400">6h atrás</span>
                                            </div>
                                            <div className="flex items-center justify-between p-3 border border-gray-200 rounded-md">
                                                <div>
                                                    <span className="text-sm font-medium">Ana Costa</span>
                                                    <p className="text-xs text-gray-500">Configurou nova política de risco</p>
                                                </div>
                                                <span className="text-xs text-gray-400">1d atrás</span>
                                            </div>
                                            <div className="flex items-center justify-between p-3 border border-gray-200 rounded-md">
                                                <div>
                                                    <span className="text-sm font-medium">Pedro Lima</span>
                                                    <p className="text-xs text-gray-500">Gerou relatório de compliance</p>
                                                </div>
                                                <span className="text-xs text-gray-400">2d atrás</span>
                                            </div>
                                        </div>
                                        <button className="mt-4 w-full text-sm text-[#343E83] hover:underline">Ver todos os logs</button>
                                    </div>

                                    {/* Políticas de PLD */}
                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                                        <h3 className="font-semibold text-gray-800 mb-4">Políticas de PLD</h3>
                                        <div className="space-y-4">
                                            <div className="p-4 border border-gray-200 rounded-md">
                                                <h4 className="font-medium text-gray-800 mb-2">Conhecimento do Cliente (KYC)</h4>
                                                <p className="text-sm text-gray-600 mb-3">Verificação obrigatória para operações acima de R$ 50.000</p>
                                                <div className="flex items-center justify-between">
                                                    <span className="text-sm text-green-600">✓ Implementado</span>
                                                    <button className="text-sm text-[#343E83] hover:underline">Configurar</button>
                                                </div>
                                            </div>
                                            <div className="p-4 border border-gray-200 rounded-md">
                                                <h4 className="font-medium text-gray-800 mb-2">Monitoramento de Transações</h4>
                                                <p className="text-sm text-gray-600 mb-3">Alertas automáticos para padrões suspeitos</p>
                                                <div className="flex items-center justify-between">
                                                    <span className="text-sm text-green-600">✓ Ativo</span>
                                                    <button className="text-sm text-[#343E83] hover:underline">Ver alertas</button>
                                                </div>
                                            </div>
                                            <div className="p-4 border border-gray-200 rounded-md">
                                                <h4 className="font-medium text-gray-800 mb-2">Relatórios COAF</h4>
                                                <p className="text-sm text-gray-600 mb-3">Comunicação automática de operações suspeitas</p>
                                                <div className="flex items-center justify-between">
                                                    <span className="text-sm text-yellow-600">⚠ Configurar</span>
                                                    <button className="text-sm text-[#343E83] hover:underline">Configurar</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Indicadores de Compliance */}
                                    <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-100 lg:col-span-2">
                                        <h3 className="font-semibold text-gray-800 mb-4">Indicadores de Compliance</h3>
                                        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                            <div className="text-center p-4 border border-gray-200 rounded-md">
                                                <div className="text-2xl font-bold text-green-600">98.5%</div>
                                                <div className="text-sm text-gray-600">Taxa de Conformidade</div>
                                            </div>
                                            <div className="text-center p-4 border border-gray-200 rounded-md">
                                                <div className="text-2xl font-bold text-blue-600">247</div>
                                                <div className="text-sm text-gray-600">Operações Monitoradas</div>
                                            </div>
                                            <div className="text-center p-4 border border-gray-200 rounded-md">
                                                <div className="text-2xl font-bold text-yellow-600">3</div>
                                                <div className="text-sm text-gray-600">Alertas Pendentes</div>
                                            </div>
                                            <div className="text-center p-4 border border-gray-200 rounded-md">
                                                <div className="text-2xl font-bold text-red-600">0</div>
                                                <div className="text-sm text-gray-600">Violações Detectadas</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Modal de Detalhes do Crédito */}
                    {selectedCredit && (
                        <div className="fixed inset-0 modal-overlay flex items-center justify-center z-50" onClick={() => setSelectedCredit(null)}>
                            <div className="bg-white rounded-lg shadow-xl w-full max-w-6xl max-h-[90vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
                                <div className="p-6 border-b border-gray-200 flex justify-between items-center">
                                    <h3 className="text-xl font-bold text-gray-800">Detalhes do Crédito {selectedCredit.id}</h3>
                                    <button className="text-gray-400 hover:text-gray-500" onClick={() => setSelectedCredit(null)}>
                                        <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <div className="p-6">
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                        {/* Informações Básicas */}
                                        <div>
                                            <h4 className="text-lg font-semibold mb-4">Informações do Crédito</h4>
                                            <div className="space-y-3">
                                                <div className="flex justify-between"><span className="text-gray-600">ID:</span><span className="font-medium">{selectedCredit.id}</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">Cliente:</span><span className="font-medium">{selectedCredit.client}</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">CNPJ:</span><span className="font-medium">{selectedCredit.cnpj}</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">Tipo:</span><span className="font-medium">{selectedCredit.type}</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">Valor Total:</span><span className="font-medium">{formatCurrency(selectedCredit.value)}</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">Taxa de Juros:</span><span className="font-medium">{selectedCredit.rate}% a.a.</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">Data de Início:</span><span className="font-medium">{selectedCredit.startDate}</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">Data de Vencimento:</span><span className="font-medium">{selectedCredit.endDate}</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">Rating Serasa:</span><span className="font-medium">{selectedCredit.serasaRating}</span></div>
                                                <div className="flex justify-between">
                                                    <span className="text-gray-600">Score Atual:</span>
                                                    <div className="flex items-center">
                                                        <span className={`risk-indicator ${calculateRealTimeScore(selectedCredit) >= 70 ? 'risk-low' : calculateRealTimeScore(selectedCredit) >= 50 ? 'risk-medium' : 'risk-high'}`}></span>
                                                        <span className="font-medium">{calculateRealTimeScore(selectedCredit)}/100</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Status de Pagamento */}
                                        <div>
                                            <h4 className="text-lg font-semibold mb-4">Status de Pagamento</h4>
                                            <div className="mb-4">
                                                <div className="flex justify-between mb-1">
                                                    <span className="text-sm font-medium">Progresso de Pagamento</span>
                                                    <span className="text-sm font-medium text-green-600">{selectedCredit.progress}%</span>
                                                </div>
                                                <div className="progress-bar w-full">
                                                    <div className={`progress-fill ${selectedCredit.status === 'Adimplente' ? 'bg-green-500' : selectedCredit.status === 'Em Atraso' ? 'bg-yellow-500' : 'bg-red-500'}`} style={{ width: `${selectedCredit.progress}%` }}></div>
                                                </div>
                                            </div>
                                            <div className="space-y-3">
                                                <div className="flex justify-between"><span className="text-gray-600">Valor Pago:</span><span className="font-medium text-green-600">{formatCurrency(selectedCredit.paidValue)}</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">Valor Restante:</span><span className="font-medium">{formatCurrency(selectedCredit.remainingValue)}</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">Próximo Pagamento:</span><span className="font-medium">{selectedCredit.nextPaymentDate}</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">Valor da Parcela:</span><span className="font-medium">{formatCurrency(selectedCredit.installmentValue)}</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">Carência:</span><span className="font-medium">{selectedCredit.carenceDays} dias</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">Prazo de Cura:</span><span className="font-medium">{selectedCredit.curePeriod} dias</span></div>
                                                <div className="flex justify-between"><span className="text-gray-600">Status:</span>
                                                    <span className={`px-2 inline-flex text-xs font-semibold rounded-full ${selectedCredit.status === 'Adimplente' ? 'bg-green-100 text-green-800' : selectedCredit.status === 'Em Atraso' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}`}>
                                                        {selectedCredit.status}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Garantias */}
                                        <div>
                                            <h4 className="text-lg font-semibold mb-4">Garantias e Colaterais</h4>
                                            <div className="space-y-3">
                                                {selectedCredit.collateral?.map((collateral, index) => (
                                                    <div key={index} className="p-3 border border-gray-200 rounded-md">
                                                        <div className="flex justify-between items-start mb-1">
                                                            <span className="text-sm font-medium">{collateral.type}</span>
                                                            <span className="text-sm font-bold text-green-600">{formatCurrency(collateral.value)}</span>
                                                        </div>
                                                        <p className="text-xs text-gray-600">{collateral.description}</p>
                                                    </div>
                                                ))}
                                                <div className="pt-3 border-t border-gray-200">
                                                    <div className="flex justify-between">
                                                        <span className="text-sm font-medium">Total Garantias:</span>
                                                        <span className="font-bold">{formatCurrency(selectedCredit.collateral?.reduce((acc, col) => acc + col.value, 0) || 0)}</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span className="text-sm font-medium">Cobertura:</span>
                                                        <span className="font-bold text-green-600">
                                                            {((selectedCredit.collateral?.reduce((acc, col) => acc + col.value, 0) || 0) / selectedCredit.remainingValue * 100).toFixed(1)}%
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Covenants */}
                                    <div className="mb-6">
                                        <h4 className="text-lg font-semibold mb-4">Covenants Financeiros</h4>
                                        <div className="overflow-x-auto">
                                            <table className="min-w-full divide-y divide-gray-200">
                                                <thead className="bg-gray-50">
                                                    <tr>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Covenant</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Limite</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Atual</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Margem</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="bg-white divide-y divide-gray-200">
                                                    {selectedCredit.covenants?.map((covenant, index) => (
                                                        <tr key={index}>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{covenant.type}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{covenant.limit}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{covenant.current}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${covenant.status === 'OK' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                                                    {covenant.status}
                                                                </span>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                                {covenant.status === 'OK' ? 
                                                                    <span className="text-green-600">
                                                                        {((covenant.limit - covenant.current) / covenant.limit * 100).toFixed(1)}%
                                                                    </span> : 
                                                                    <span className="text-red-600">
                                                                        -{((covenant.current - covenant.limit) / covenant.limit * 100).toFixed(1)}%
                                                                    </span>
                                                                }
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    {/* Triggers de Vencimento Antecipado */}
                                    <div className="mb-6">
                                        <h4 className="text-lg font-semibold mb-4">Análise de Vencimento Antecipado</h4>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div className="p-4 border border-gray-200 rounded-md">
                                                <h5 className="font-medium mb-2">Triggers Ativos</h5>
                                                {checkEarlyMaturityTriggers(selectedCredit).length > 0 ? (
                                                    <ul className="space-y-1">
                                                        {checkEarlyMaturityTriggers(selectedCredit).map((trigger, index) => (
                                                            <li key={index} className="text-sm text-red-700 flex items-center">
                                                                <svg className="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                                </svg>
                                                                {trigger}
                                                            </li>
                                                        ))}
                                                    </ul>
                                                ) : (
                                                    <p className="text-sm text-green-600">Nenhum trigger ativo</p>
                                                )}
                                            </div>
                                            <div className="p-4 border border-gray-200 rounded-md">
                                                <h5 className="font-medium mb-2">Valor Acelerado</h5>
                                                <div className="space-y-2">
                                                    <div className="flex justify-between">
                                                        <span className="text-sm text-gray-600">Saldo Atual:</span>
                                                        <span className="text-sm font-medium">{formatCurrency(selectedCredit.remainingValue)}</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span className="text-sm text-gray-600">Valor Acelerado:</span>
                                                        <span className="text-sm font-bold text-red-600">{formatCurrency(calculateAcceleratedValue(selectedCredit))}</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span className="text-sm text-gray-600">Diferença:</span>
                                                        <span className="text-sm font-bold text-red-600">
                                                            +{formatCurrency(calculateAcceleratedValue(selectedCredit) - selectedCredit.remainingValue)}
                                                        </span>
                                                    </div>
                                                </div>
                                                {checkEarlyMaturityTriggers(selectedCredit).length > 0 && (
                                                    <button className="mt-3 w-full px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition">
                                                        Executar Vencimento Antecipado
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    </div>

                                    {/* Alertas */}
                                    <div className="mb-6">
                                        <h4 className="text-lg font-semibold mb-4">Alertas</h4>
                                        {selectedCredit.alerts.length > 0 ? (
                                            <ul className="space-y-2">
                                                {selectedCredit.alerts.map((alert, index) => (
                                                    <li key={index} className="text-sm text-red-600 flex items-center">
                                                        <svg className="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                        </svg>
                                                        {alert}
                                                    </li>
                                                ))}
                                            </ul>
                                        ) : (
                                            <p className="text-sm text-green-600">Nenhum alerta ativo</p>
                                        )}
                                    </div>

                                    {/* Upload de Documentos */}
                                    <div className="mb-6">
                                        <h4 className="text-lg font-semibold mb-4">Upload de Documentos</h4>
                                        <input
                                            type="file"
                                            multiple
                                            accept=".txt,.pdf,.doc,.docx,.xlsx,.xls"
                                            className="mb-4 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-[#343E83] file:text-white hover:file:bg-opacity-80"
                                            onChange={(e) => handleFileUpload(e, selectedCredit.id)}
                                        />
                                        <p className="text-xs text-gray-500 mb-4">Suportados: TXT, PDF, DOC, DOCX, XLS, XLSX (máx. 10MB)</p>
                                        {(uploadedDocuments[selectedCredit.id] || []).length > 0 && (
                                            <div className="space-y-2">
                                                <h5 className="text-sm font-medium text-gray-700">Documentos Carregados:</h5>
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                                    {(uploadedDocuments[selectedCredit.id] || []).map((doc, index) => (
                                                        <div key={index} className="p-3 border border-gray-200 rounded-md">
                                                            <div className="flex items-center justify-between mb-1">
                                                                <span className="text-sm font-medium">{doc.name}</span>
                                                                {doc.alerts.length > 0 && (
                                                                    <span className="text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full">
                                                                        {doc.alerts.length} alertas
                                                                    </span>
                                                                )}
                                                            </div>
                                                            {doc.alerts.length > 0 && (
                                                                <ul className="text-xs text-red-600 mt-2">
                                                                    {doc.alerts.map((alert, alertIndex) => (
                                                                        <li key={alertIndex} className="flex items-center">
                                                                            <svg className="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                                            </svg>
                                                                            {alert}
                                                                        </li>
                                                                    ))}
                                                                </ul>
                                                            )}
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        )}
                                    </div>

                                    {/* Histórico de Pagamentos */}
                                    <div className="mb-6">
                                        <h4 className="text-lg font-semibold mb-4">Histórico de Pagamentos</h4>
                                        <div className="overflow-x-auto">
                                            <table className="min-w-full divide-y divide-gray-200">
                                                <thead className="bg-gray-50">
                                                    <tr>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Atraso</th>
                                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Comprovante</th>
                                                    </tr>
                                                </thead>
                                                <tbody className="bg-white divide-y divide-gray-200">
                                                    {(paymentHistory[selectedCredit.id] || []).map((payment, index) => (
                                                        <tr key={index}>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{payment.date}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{formatCurrency(payment.value)}</td>
                                                            <td className="px-6 py-4 whitespace-nowrap">
                                                                <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${payment.status === 'Pago' ? 'bg-green-100 text-green-800' : payment.status === 'Atrasado' ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}`}>
                                                                    {payment.status}
                                                                </span>
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                                                                {payment.days > 0 ? `${payment.days} dias` : '-'}
                                                            </td>
                                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-[#343E83] hover:text-[#2a326b] cursor-pointer">
                                                                {payment.receipt ? payment.receipt : 'N/A'}
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    {/* Dossiê de Crédito */}
                                    <div className="mb-6">
                                        <h4 className="text-lg font-semibold mb-4">Dossiê de Crédito</h4>
                                        <textarea
                                            className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#343E83]"
                                            rows="5"
                                            placeholder="Adicione seu parecer analítico aqui..."
                                            value={dossierNotes}
                                            onChange={(e) => setDossierNotes(e.target.value)}
                                        ></textarea>
                                        <button
                                            className="mt-3 px-4 py-2 bg-[#343E83] text-white rounded-md hover:bg-opacity-90"
                                            onClick={() => {
                                                const dossier = `
DOSSIÊ DE CRÉDITO - ${selectedCredit.client} (${selectedCredit.id})
==========================================

INFORMAÇÕES BÁSICAS
Cliente: ${selectedCredit.client}
CNPJ: ${selectedCredit.cnpj}
Tipo de Crédito: ${selectedCredit.type}
Setor: ${selectedCredit.sector}
Valor Total: ${formatCurrency(selectedCredit.value)}
Taxa de Juros: ${selectedCredit.rate}% a.a.
Status: ${selectedCredit.status}

ANÁLISE DE RISCO
Rating Serasa: ${selectedCredit.serasaRating}
Score Original: ${selectedCredit.riskScore}/100
Score Atual: ${calculateRealTimeScore(selectedCredit)}/100
PDD: ${selectedCredit.pdd}%
Recovery Rate: ${selectedCredit.recoveryRate}%

SITUAÇÃO FINANCEIRA
Progresso de Pagamento: ${selectedCredit.progress}%
Valor Pago: ${formatCurrency(selectedCredit.paidValue)}
Valor Restante: ${formatCurrency(selectedCredit.remainingValue)}
Data de Início: ${selectedCredit.startDate}
Data de Vencimento: ${selectedCredit.endDate}
Próximo Pagamento: ${selectedCredit.nextPaymentDate}
Valor da Parcela: ${formatCurrency(selectedCredit.installmentValue)}

GARANTIAS E COLATERAIS
${selectedCredit.collateral?.map(col => `- ${col.type}: ${formatCurrency(col.value)} (${col.description})`).join('\n') || 'Nenhuma garantia cadastrada'}
Total de Garantias: ${formatCurrency(selectedCredit.collateral?.reduce((acc, col) => acc + col.value, 0) || 0)}
Cobertura: ${((selectedCredit.collateral?.reduce((acc, col) => acc + col.value, 0) || 0) / selectedCredit.remainingValue * 100).toFixed(1)}%

COVENANTS FINANCEIROS
${selectedCredit.covenants?.map(covenant => `- ${covenant.type}: ${covenant.current} (Limite: ${covenant.limit}) - ${covenant.status}`).join('\n') || 'Nenhum covenant cadastrado'}

VENCIMENTO ANTECIPADO
Triggers Ativos: ${checkEarlyMaturityTriggers(selectedCredit).join(', ') || 'Nenhum'}
Valor Acelerado: ${formatCurrency(calculateAcceleratedValue(selectedCredit))}
Diferença: ${formatCurrency(calculateAcceleratedValue(selectedCredit) - selectedCredit.remainingValue)}

ALERTAS
${selectedCredit.alerts.join(', ') || 'Nenhum alerta ativo'}

DOCUMENTOS ANEXADOS
${(uploadedDocuments[selectedCredit.id] || []).map(doc => `- ${doc.name} (${doc.alerts.length} alertas)`).join('\n') || 'Nenhum documento anexado'}

PARECER ANALÍTICO
${dossierNotes || 'Parecer não inserido.'}

CONFIGURAÇÕES DE CARÊNCIA
Dias de Carência: ${selectedCredit.carenceDays} dias
Prazo de Cura: ${selectedCredit.curePeriod} dias

DATA DE GERAÇÃO: ${new Date().toLocaleString('pt-BR')}
==========================================
                                                `;
                                                
                                                const blob = new Blob([dossier], { type: 'text/plain' });
                                                const url = URL.createObjectURL(blob);
                                                const a = document.createElement('a');
                                                a.href = url;
                                                a.download = `Dossie_${selectedCredit.id}_${new Date().toISOString().split('T')[0]}.txt`;
                                                a.click();
                                                URL.revokeObjectURL(url);
                                            }}
                                        >
                                            Gerar e Baixar Dossiê
                                        </button>
                                    </div>

                                    <div className="flex justify-end space-x-3">
                                        <button className="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50">
                                            Exportar Relatório
                                        </button>
                                        <button className="px-4 py-2 bg-[#343E83] text-white rounded-md hover:bg-opacity-90">
                                            Enviar Notificação
                                        </button>
                                        <button className="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">
                                            Ações de Cobrança
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal de Configuração de Políticas */}
                    {showPolicyModal && (
                        <div className="fixed inset-0 modal-overlay flex items-center justify-center z-50" onClick={() => setShowPolicyModal(false)}>
                            <div className="bg-white rounded-lg shadow-xl w-full max-w-2xl" onClick={e => e.stopPropagation()}>
                                <div className="p-6 border-b border-gray-200 flex justify-between items-center">
                                    <h3 className="text-xl font-bold text-gray-800">Configurar Políticas de Crédito</h3>
                                    <button className="text-gray-400 hover:text-gray-500" onClick={() => setShowPolicyModal(false)}>
                                        <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <div className="p-6">
                                    <div className="space-y-6">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Score Mínimo</label>
                                            <input
                                                type="number"
                                                className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#343E83]"
                                                value={policies.minScore}
                                                onChange={(e) => setPolicies({...policies, minScore: parseInt(e.target.value)})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Exposição Máxima (R$)</label>
                                            <input
                                                type="number"
                                                className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#343E83]"
                                                value={policies.maxExposure}
                                                onChange={(e) => setPolicies({...policies, maxExposure: parseInt(e.target.value)})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Cobertura de Garantia Mínima (%)</label>
                                            <input
                                                type="number"
                                                className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#343E83]"
                                                value={policies.minCollateralCoverage}
                                                onChange={(e) => setPolicies({...policies, minCollateralCoverage: parseInt(e.target.value)})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Dívida/EBITDA Máximo</label>
                                            <input
                                                type="number"
                                                step="0.1"
                                                className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#343E83]"
                                                value={policies.maxDebtToEbitda}
                                                onChange={(e) => setPolicies({...policies, maxDebtToEbitda: parseFloat(e.target.value)})}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Cobertura de Juros Mínima</label>
                                            <input
                                                type="number"
                                                step="0.1"
                                                className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#343E83]"
                                                value={policies.minInterestCoverage}
                                                onChange={(e) => setPolicies({...policies, minInterestCoverage: parseFloat(e.target.value)})}
                                            />
                                        </div>
                                    </div>
                                    <div className="flex justify-end space-x-3 mt-6">
                                        <button 
                                            className="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50"
                                            onClick={() => setShowPolicyModal(false)}
                                        >
                                            Cancelar
                                        </button>
                                        <button 
                                            className="px-4 py-2 bg-[#343E83] text-white rounded-md hover:bg-opacity-90"
                                            onClick={() => {
                                                setShowPolicyModal(false);
                                                // Aqui você salvaria as políticas
                                            }}
                                        >
                                            Salvar Políticas
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Modal de Upload de Balanço */}
                    {showBalanceUpload && (
                        <div className="fixed inset-0 modal-overlay flex items-center justify-center z-50" onClick={() => setShowBalanceUpload(false)}>
                            <div className="bg-white rounded-lg shadow-xl w-full max-w-2xl" onClick={e => e.stopPropagation()}>
                                <div className="p-6 border-b border-gray-200 flex justify-between items-center">
                                    <h3 className="text-xl font-bold text-gray-800">Upload de Balanço</h3>
                                    <button className="text-gray-400 hover:text-gray-500" onClick={() => setShowBalanceUpload(false)}>
                                        <svg className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <div className="p-6">
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Selecionar Cliente</label>
                                            <select className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#343E83]">
                                                <option value="">Selecione um cliente...</option>
                                                {creditData.map(credit => (
                                                    <option key={credit.id} value={credit.id}>{credit.client} - {credit.id}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Tipo de Demonstrativo</label>
                                            <select className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#343E83]">
                                                <option value="balanco">Balanço Patrimonial</option>
                                                <option value="dre">DRE - Demonstração do Resultado</option>
                                                <option value="dfc">DFC - Demonstração dos Fluxos de Caixa</option>
                                                <option value="completo">Demonstrativo Completo</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Período de Referência</label>
                                            <input
                                                type="month"
                                                className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#343E83]"
                                                defaultValue="2023-12"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Arquivo</label>
                                            <input
                                                type="file"
                                                accept=".xlsx,.xls,.pdf"
                                                className="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#343E83]"
                                            />
                                            <p className="text-xs text-gray-500 mt-1">Formatos aceitos: XLSX, XLS, PDF (máx. 25MB)</p>
                                        </div>
                                        <div className="bg-blue-50 border border-blue-200 rounded-md p-4">
                                            <h4 className="font-medium text-blue-800 mb-2">Análise Automática</h4>
                                            <p className="text-sm text-blue-700">
                                                O sistema irá automaticamente:
                                            </p>
                                            <ul className="text-sm text-blue-700 mt-1 list-disc list-inside">
                                                <li>Extrair indicadores financeiros</li>
                                                <li>Verificar compliance com covenants</li>
                                                <li>Detectar deterioração de indicadores</li>
                                                <li>Gerar alertas automáticos</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div className="flex justify-end space-x-3 mt-6">
                                        <button 
                                            className="px-4 py-2 border border-gray-300 rounded-md hover:bg-gray-50"
                                            onClick={() => setShowBalanceUpload(false)}
                                        >
                                            Cancelar
                                        </button>
                                        <button 
                                            className="px-4 py-2 bg-[#343E83] text-white rounded-md hover:bg-opacity-90"
                                            onClick={() => {
                                                setShowBalanceUpload(false);
                                                // Aqui você processaria o upload
                                            }}
                                        >
                                            Fazer Upload e Analisar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    <footer className="bg-white border-t border-gray-200 py-4 mt-8">
                        <div className="container mx-auto px-4 text-center text-sm text-gray-500">
                            © 2025 SecuriCredit Monitor. Todos os direitos reservados. | Versão 2.0 - Sistema Completo de Monitoramento
                        </div>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<CreditMonitoringSystem />, document.getElementById('root'));
    </script>
</body>
</html>
